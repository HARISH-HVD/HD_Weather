<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Harish D</title>
  <link rel="website icon" type="png" href="ORIGINAL.jpg">
  <style>
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --accent-color: #4895ef;
      --danger-color: #f72585;
      --success-color: #4cc9f0;
      --warning-color: #f8961e;
      --light-color: #f8f9fa;
      --dark-color: #212529;
      --border-radius: 12px;
      --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f7fa;
      color: var(--dark-color);
      line-height: 1.6;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 2.5rem;
      color: var(--primary-color);
      margin-bottom: 10px;
      font-weight: 700;
    }

    #weather {
      background: linear-gradient(135deg, #e0f7fa 0%, #b3e5fc 100%);
      padding: 15px;
      border-radius: var(--border-radius);
      margin: 20px auto;
      max-width: 600px;
      font-weight: 600;
      box-shadow: var(--box-shadow);
      font-size: 1.1rem;
      text-align: center;
    }

    .notification-banner {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 300px;
      padding: 15px;
      background-color: var(--success-color);
      color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transform: translateX(150%);
      transition: transform 0.3s ease;
    }

    .notification-banner.show {
      transform: translateX(0);
    }

    .notification-banner.error {
      background-color: var(--danger-color);
    }

    .notification-banner.warning {
      background-color: var(--warning-color);
    }

    .close-notification {
      background: none;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
    }

    .controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 30px;
    }

    input[type="date"], 
    button,
    select {
      padding: 12px 20px;
      border-radius: var(--border-radius);
      border: none;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition);
    }

    input[type="date"] {
      border: 1px solid #ced4da;
      background-color: white;
    }

    select {
      border: 1px solid #ced4da;
      background-color: white;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 1em;
      padding-right: 35px;
    }

    button {
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button:hover {
      background-color: var(--secondary-color);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .main-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
      margin-bottom: 30px;
    }

    .slot-container {
      width: 100%;
      max-width: 700px;
    }

    .slot {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 25px;
      box-shadow: var(--box-shadow);
      transition: var(--transition);
      margin-bottom: 20px;
    }

    .slot:hover {
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }

    .time {
      font-size: 1.8rem;
      font-weight: 700;
      text-align: center;
      color: var(--dark-color);
      margin-bottom: 20px;
    }

    textarea {
      width: 100%;
      height: 120px;
      padding: 15px;
      border: 1px solid #ced4da;
      border-radius: var(--border-radius);
      font-size: 1rem;
      resize: vertical;
      margin-bottom: 15px;
      transition: var(--transition);
    }

    textarea:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
    }

    .sound-selection {
      margin-top: 15px;
      padding: 15px;
      border-radius: var(--border-radius);
      background-color: #f8f9fa;
      border: 1px solid #e9ecef;
    }
    
    .sound-option {
      display: flex;
      align-items: center;
      margin: 10px 0;
    }
    
    .sound-option label {
      display: flex;
      align-items: center;
      cursor: pointer;
      width: 100%;
      justify-content: space-between;
    }
    
    .sound-preview {
      margin-left: 10px;
      font-size: 0.9rem;
      color: var(--primary-color);
      cursor: pointer;
      padding: 5px 10px;
      border-radius: 6px;
      background-color: rgba(67, 97, 238, 0.1);
      transition: var(--transition);
    }

    .sound-preview:hover {
      background-color: rgba(67, 97, 238, 0.2);
    }

    .past { background-color: #fff3f5; }
    .present { background-color: #fff8e6; }
    .future { background-color: #f0fdf4; }

    .nav-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }

    #reminderList {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 25px;
      box-shadow: var(--box-shadow);
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
    }

    #reminderList h3 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: 20px;
      font-size: 1.5rem;
    }

    .reminder-item {
      padding: 15px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: var(--transition);
    }

    .reminder-item:hover {
      background-color: #f8f9fa;
    }

    .delete-btn {
      background-color: var(--danger-color);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .delete-btn:hover {
      background-color: #d1144a;
    }

    footer {
      background-color: var(--dark-color);
      color: white;
      text-align: center;
      padding: 20px;
      margin-top: auto;
      border-radius: var(--border-radius);
    }

    footer p {
      margin: 5px 0;
    }

    footer a {
      color: var(--success-color);
      text-decoration: none;
      transition: var(--transition);
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* Hidden file input */
    #fileInput {
      display: none;
    }

    /* Notification settings dropdown */
    .settings-dropdown {
      position: relative;
      display: inline-block;
      margin-bottom: 20px;
    }

    .settings-btn {
      background-color: var(--accent-color);
      padding: 10px 20px;
      border-radius: var(--border-radius);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .settings-content {
      display: none;
      position: absolute;
      background-color: white;
      min-width: 250px;
      box-shadow: var(--box-shadow);
      border-radius: var(--border-radius);
      z-index: 1;
      right: 0;
      padding: 15px;
    }

    .settings-dropdown:hover .settings-content {
      display: block;
    }

    .settings-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--primary-color);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }

      .controls {
        flex-direction: column;
        align-items: center;
      }

      .slot, #reminderList {
        padding: 20px;
      }

      .time {
        font-size: 1.5rem;
      }

      .notification-banner {
        width: calc(100% - 40px);
        right: 20px;
        left: 20px;
      }

      .settings-content {
        min-width: 200px;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 15px;
      }

      h1 {
        font-size: 1.8rem;
      }

      .slot, #reminderList {
        padding: 15px;
      }

      button, input[type="date"], select {
        width: 100%;
        justify-content: center;
      }

      .nav-buttons {
        width: 100%;
      }

      .nav-buttons button {
        flex: 1;
      }

      .settings-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .sound-option label {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
      }

      .sound-preview {
        margin-left: 0;
        align-self: flex-end;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>⏰ Smart Scheduler with Weather</h1>
      <div id="weather">Loading weather...</div>
    </header>

    <div class="settings-dropdown">
      <button class="settings-btn">⚙️ Notification Settings</button>
      <div class="settings-content">
        <div class="settings-row">
          <span>Desktop Notifications</span>
          <label class="toggle-switch">
            <input type="checkbox" id="desktopNotificationsToggle" checked>
            <span class="slider"></span>
          </label>
        </div>
        <div class="settings-row">
          <span>In-App Notifications</span>
          <label class="toggle-switch">
            <input type="checkbox" id="inAppNotificationsToggle" checked>
            <span class="slider"></span>
          </label>
        </div>
        <div class="settings-row">
          <span>10-Minute Advance Alerts</span>
          <label class="toggle-switch">
            <input type="checkbox" id="advanceAlertsToggle" checked>
            <span class="slider"></span>
          </label>
        </div>
        <div class="settings-row">
          <span>Notification Sound</span>
          <select id="defaultSoundSelect">
            <option value="classic">Classic Alarm</option>
            <option value="chime">Gentle Chime</option>
            <option value="digital">Digital Beep</option>
          </select>
        </div>
      </div>
    </div>

    <div class="controls">
      <input type="date" id="datePicker">
      <button onclick="exportSchedule()">📤 Export</button>
      <button onclick="document.getElementById('fileInput').click()">📥 Import</button>
      <input type="file" id="fileInput" accept=".txt" onchange="importSchedule(event)">
    </div>

    <div class="main-content">
      <div class="slot-container">
        <div class="slot" id="slot">
          <div class="time" id="timeLabel"></div>
          <textarea id="noteInput" placeholder="Type your note here..."></textarea>
          
          <div class="sound-selection">
            <strong>🔊 Reminder Sound:</strong>
            <div class="sound-option">
              <input type="radio" id="sound1" name="reminderSound" value="classic" checked>
              <label for="sound1">
                Classic Alarm 
                <span class="sound-preview" onclick="previewSound('classic')">▶️ Preview</span>
              </label>
            </div>
            <div class="sound-option">
              <input type="radio" id="sound2" name="reminderSound" value="chime">
              <label for="sound2">
                Gentle Chime 
                <span class="sound-preview" onclick="previewSound('chime')">▶️ Preview</span>
              </label>
            </div>
            <div class="sound-option">
              <input type="radio" id="sound3" name="reminderSound" value="digital">
              <label for="sound3">
                Digital Beep 
                <span class="sound-preview" onclick="previewSound('digital')">▶️ Preview</span>
              </label>
            </div>
          </div>
          
          <button onclick="saveNote()">💾 Save Note & Set Reminder</button>
        </div>
      </div>

      <div class="nav-buttons">
        <button onclick="prevHour()">⏮️ Previous Hour</button>
        <button onclick="nextHour()">⏭️ Next Hour</button>
      </div>

      <div id="reminderList">
        <h3>📋 Reminders for Selected Day</h3>
        <div id="reminderItems"></div>
      </div>
    </div>
  </div>

  <div class="notification-banner" id="notificationBanner">
    <span id="notificationMessage"></span>
    <button class="close-notification" onclick="closeNotification()">×</button>
  </div>

  <footer>
    <p>&copy; Smart Scheduler | Harish Vinod Dasarwar</p>
    <p>Powered by <a href="https://harish-hvd.github.io/My-Portfolio/" target="_blank">Harish Dasarwar</a></p>
  </footer>

  <script>
    const apiKey = "f9ba4ce06a18d646f22fba5d687a66f1";
    const datePicker = document.getElementById("datePicker");
    const timeLabel = document.getElementById("timeLabel");
    const noteInput = document.getElementById("noteInput");
    const reminderItems = document.getElementById("reminderItems");
    const notificationBanner = document.getElementById("notificationBanner");
    const notificationMessage = document.getElementById("notificationMessage");
    const desktopNotificationsToggle = document.getElementById("desktopNotificationsToggle");
    const inAppNotificationsToggle = document.getElementById("inAppNotificationsToggle");
    const advanceAlertsToggle = document.getElementById("advanceAlertsToggle");
    const defaultSoundSelect = document.getElementById("defaultSoundSelect");
    const today = new Date().toISOString().split("T")[0];
    let currentHour = new Date().getHours();
    datePicker.value = today;

    // Audio elements for preview
    const audioElements = {};

    // Sound URLs
    const SOUNDS = {
      classic: 'https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3',
      chime: 'https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-221.mp3',
      digital: 'https://assets.mixkit.co/sfx/preview/mixkit-retro-game-emergency-alarm-1000.mp3',
      advance: 'https://assets.mixkit.co/sfx/preview/mixkit-clear-announce-tones-2861.mp3'
    };

    // Initialize audio elements
    function initAudioElements() {
      for (const [key, url] of Object.entries(SOUNDS)) {
        audioElements[key] = new Audio(url);
      }
    }

    // Active timeouts storage
    const activeReminders = {};

    // Load settings from localStorage
    function loadSettings() {
      const desktopEnabled = localStorage.getItem('desktopNotifications') !== 'false';
      const inAppEnabled = localStorage.getItem('inAppNotifications') !== 'false';
      const advanceAlertsEnabled = localStorage.getItem('advanceAlerts') !== 'false';
      const defaultSound = localStorage.getItem('defaultSound') || 'classic';
      
      desktopNotificationsToggle.checked = desktopEnabled;
      inAppNotificationsToggle.checked = inAppEnabled;
      advanceAlertsToggle.checked = advanceAlertsEnabled;
      defaultSoundSelect.value = defaultSound;
      
      // Set default sound selection
      document.querySelector(`input[name="reminderSound"][value="${defaultSound}"]`).checked = true;
      
      // Request permission if desktop notifications are enabled
      if (desktopEnabled && Notification.permission === "default") {
        Notification.requestPermission();
      }
      
      // Set up existing reminders
      setupExistingReminders();
    }

    // Save settings to localStorage
    function saveSettings() {
      localStorage.setItem('desktopNotifications', desktopNotificationsToggle.checked);
      localStorage.setItem('inAppNotifications', inAppNotificationsToggle.checked);
      localStorage.setItem('advanceAlerts', advanceAlertsToggle.checked);
      localStorage.setItem('defaultSound', defaultSoundSelect.value);
      showNotification("Settings saved successfully!", "success");
      
      // Update default sound selection
      document.querySelector(`input[name="reminderSound"][value="${defaultSoundSelect.value}"]`).checked = true;
    }

    // Show notification banner
    function showNotification(message, type = "success") {
      if (!inAppNotificationsToggle.checked) return;
      
      notificationMessage.textContent = message;
      notificationBanner.className = `notification-banner ${type}`;
      notificationBanner.classList.add("show");
      
      // Auto-hide after 5 seconds
      setTimeout(() => {
        notificationBanner.classList.remove("show");
      }, 5000);
    }

    function closeNotification() {
      notificationBanner.classList.remove("show");
    }

    // Request notification permission if needed
    function checkNotificationPermission() {
      if (desktopNotificationsToggle.checked && Notification.permission === "default") {
        Notification.requestPermission().then(permission => {
          if (permission === "granted") {
            showNotification("Desktop notifications enabled!", "success");
          } else {
            showNotification("Desktop notifications blocked", "warning");
            desktopNotificationsToggle.checked = false;
            saveSettings();
          }
        });
      }
    }

    // Preview sound function
    function previewSound(type) {
      if (audioElements[type]) {
        audioElements[type].currentTime = 0;
        audioElements[type].play().catch(e => {
          showNotification("Please interact with the page first to enable sound", "error");
          console.log("Audio preview prevented:", e);
        });
      }
    }

    // Play notification sound
    function playNotificationSound(type = 'classic') {
      if (!inAppNotificationsToggle.checked && !desktopNotificationsToggle.checked) return;
      
      if (audioElements[type]) {
        audioElements[type].play().catch(e => console.log("Audio playback prevented:", e));
      }
    }

    // Send desktop notification
    function sendNotification(title, message) {
      if (Notification.permission === "granted" && desktopNotificationsToggle.checked) {
        const notification = new Notification(title, { 
          body: message,
          icon: 'https://cdn-icons-png.flaticon.com/512/3652/3652191.png'
        });
        
        notification.onclick = () => {
          window.focus();
        };
      }
    }

    // Weather fetch
    function fetchWeather() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async position => {
          const { latitude, longitude } = position.coords;
          const url = `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&units=metric&appid=${apiKey}`;
          try {
            const res = await fetch(url);
            const data = await res.json();
            
            const weatherText = getWeatherEmoji(data.weather[0].description) + " " + data.name + ": " + 
                              data.weather[0].description + ", " + data.main.temp + "°C";
            document.getElementById("weather").textContent = weatherText;
          } catch (error) {
            showNotification("Failed to fetch weather data", "error");
            document.getElementById("weather").textContent = "Weather data unavailable";
          }
        }, () => {
          showNotification("Weather not available (location denied)", "warning");
          document.getElementById("weather").textContent = "Weather not available (location denied)";
        });
      } else {
        document.getElementById("weather").textContent = "Weather not available (geolocation not supported)";
      }
    }

    function getWeatherEmoji(description) {
      if (description.includes("clear")) return "☀️";
      if (description.includes("cloud")) return "☁️";
      if (description.includes("rain")) return "🌧️";
      if (description.includes("snow")) return "❄️";
      if (description.includes("thunder")) return "⚡";
      if (description.includes("fog")) return "🌫️";
      return "🌤️";
    }

    function updateSlot() {
      const date = datePicker.value;
      const key = `${date}-note-${currentHour}`;
      const nowHour = new Date().getHours();

      timeLabel.textContent = `${currentHour.toString().padStart(2, '0')}:00`;
      
      // Load note and sound preference
      const reminderData = localStorage.getItem(key);
      if (reminderData) {
        try {
          const { text, sound } = JSON.parse(reminderData);
          noteInput.value = text;
          document.querySelector(`input[name="reminderSound"][value="${sound || defaultSoundSelect.value}"]`).checked = true;
        } catch (e) {
          noteInput.value = reminderData;
          document.querySelector(`input[name="reminderSound"][value="${defaultSoundSelect.value}"]`).checked = true;
        }
      } else {
        noteInput.value = "";
        document.querySelector(`input[name="reminderSound"][value="${defaultSoundSelect.value}"]`).checked = true;
      }

      const slot = document.getElementById("slot");
      slot.classList.remove("past", "present", "future");
      if (date === today) {
        if (currentHour < nowHour) slot.classList.add("past");
        else if (currentHour === nowHour) slot.classList.add("present");
        else slot.classList.add("future");
      }

      displayReminders();
    }

    function saveNote() {
      const date = datePicker.value;
      const key = `${date}-note-${currentHour}`;
      const note = noteInput.value.trim();
      const soundType = document.querySelector('input[name="reminderSound"]:checked').value;
      
      if (!note) {
        showNotification("Please enter a note before saving", "error");
        return;
      }
      
      // Clear any existing reminders for this slot
      clearReminderTimeout(key);
      
      // Save the reminder with sound preference
      const reminderData = {
        text: note,
        sound: soundType,
        timestamp: new Date().getTime()
      };
      localStorage.setItem(key, JSON.stringify(reminderData));
      
      showNotification("Note saved successfully!", "success");

      // Set up reminders if it's for today
      if (date === today) {
        scheduleReminder(key, currentHour, note, soundType);
      }

      displayReminders();
    }

    // Schedule reminder with 10-minute advance notice
    function scheduleReminder(key, hour, note, soundType) {
      const now = new Date();
      const reminderTime = new Date(now);
      reminderTime.setHours(hour, 0, 0, 0);
      
      // Calculate time differences
      const mainReminderDelay = reminderTime - now;
      
      // Set advance reminder (10 minutes before) if enabled
      if (advanceAlertsToggle.checked) {
        const advanceReminderDelay = mainReminderDelay - (10 * 60 * 1000);
        
        if (advanceReminderDelay > 0) {
          activeReminders[`advance-${key}`] = setTimeout(() => {
            const advanceText = `Reminder coming up in 10 minutes: ${hour.toString().padStart(2, '0')}:00 - ${note}`;
            
            // Play advance notification sound
            playNotificationSound('advance');
            
            // Show notifications
            if (desktopNotificationsToggle.checked) {
              sendNotification(`⏰ Upcoming Reminder (10 min)`, advanceText);
            }
            
            if (inAppNotificationsToggle.checked) {
              showNotification(advanceText, "warning");
            }
          }, advanceReminderDelay);
        }
      }
      
      // Set main reminder (at scheduled time)
      if (mainReminderDelay > 0) {
        activeReminders[key] = setTimeout(() => {
          const reminderText = `${hour.toString().padStart(2, '0')}:00 - ${note}`;
          
          // Play the selected notification sound
          playNotificationSound(soundType);
          
          // Show notifications
          if (desktopNotificationsToggle.checked) {
            sendNotification(`🔔 ${hour.toString().padStart(2, '0')}:00 Reminder`, note);
          }
          
          if (inAppNotificationsToggle.checked) {
            showNotification(reminderText, "success");
          }
          
          // Remove from active reminders
          delete activeReminders[key];
        }, mainReminderDelay);
      }
    }

    // Clear existing reminder timeout
    function clearReminderTimeout(key) {
      if (activeReminders[key]) {
        clearTimeout(activeReminders[key]);
        delete activeReminders[key];
      }
      if (activeReminders[`advance-${key}`]) {
        clearTimeout(activeReminders[`advance-${key}`]);
        delete activeReminders[`advance-${key}`];
      }
    }

    // Set up existing reminders on page load
    function setupExistingReminders() {
      const date = today;
      for (let hour = 0; hour < 24; hour++) {
        const key = `${date}-note-${hour}`;
        const reminderData = localStorage.getItem(key);
        if (reminderData) {
          try {
            const { text, sound } = JSON.parse(reminderData);
            if (hour > new Date().getHours()) {
              scheduleReminder(key, hour, text, sound || defaultSoundSelect.value);
            }
          } catch (e) {
            if (hour > new Date().getHours()) {
              scheduleReminder(key, hour, reminderData, defaultSoundSelect.value);
            }
          }
        }
      }
    }

    function deleteReminder(hour) {
      const date = datePicker.value;
      const key = `${date}-note-${hour}`;
      
      // Clear any scheduled reminders
      clearReminderTimeout(key);
      
      localStorage.removeItem(key);
      if (hour === currentHour) {
        noteInput.value = "";
        document.querySelector(`input[name="reminderSound"][value="${defaultSoundSelect.value}"]`).checked = true;
      }
      showNotification("Reminder deleted", "success");
      displayReminders();
    }

    function displayReminders() {
      const date = datePicker.value;
      reminderItems.innerHTML = "";
      const hasReminders = Array.from({ length: 24 }).some((_, hour) => {
        const key = `${date}-note-${hour}`;
        return localStorage.getItem(key);
      });

      if (!hasReminders) {
        reminderItems.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No reminders set for this day</div>';
        return;
      }

      for (let hour = 0; hour < 24; hour++) {
        const key = `${date}-note-${hour}`;
        const reminderData = localStorage.getItem(key);
        if (reminderData) {
          try {
            const { text, sound } = JSON.parse(reminderData);
            const div = document.createElement("div");
            div.className = "reminder-item";
            div.innerHTML = `
              <span>${hour.toString().padStart(2, '0')}:00 - ${text} <small>(Sound: ${sound || defaultSoundSelect.value})</small></span>
              <button class="delete-btn" onclick="deleteReminder(${hour})">❌ Delete</button>
            `;
            reminderItems.appendChild(div);
          } catch (e) {
            // Fallback for old format
            const div = document.createElement("div");
            div.className = "reminder-item";
            div.innerHTML = `
              <span>${hour.toString().padStart(2, '0')}:00 - ${reminderData} <small>(Sound: ${defaultSoundSelect.value})</small></span>
              <button class="delete-btn" onclick="deleteReminder(${hour})">❌ Delete</button>
            `;
            reminderItems.appendChild(div);
          }
        }
      }
    }

    function nextHour() {
      if (currentHour < 23) {
        currentHour++;
        updateSlot();
      }
    }

    function prevHour() {
      if (currentHour > 0) {
        currentHour--;
        updateSlot();
      }
    }

    function exportSchedule() {
      const date = datePicker.value;
      let content = `Schedule for ${date}\n\n`;
      for (let hour = 0; hour < 24; hour++) {
        const key = `${date}-note-${hour}`;
        const reminderData = localStorage.getItem(key);
        if (reminderData) {
          try {
            const { text, sound } = JSON.parse(reminderData);
            content += `${hour.toString().padStart(2, '0')}:00 - ${text} | Sound:${sound || defaultSoundSelect.value}\n`;
          } catch (e) {
            content += `${hour.toString().padStart(2, '0')}:00 - ${reminderData} | Sound:${defaultSoundSelect.value}\n`;
          }
        }
      }
      const blob = new Blob([content], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `Schedule_${date}.txt`;
      a.click();
      showNotification("Schedule exported successfully!", "success");
    }

    function importSchedule(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const content = e.target.result.split("\n");
        let importedCount = 0;
        
        content.forEach(line => {
          const match = line.match(/(\d{2}):00 - (.*?) \| Sound:(\w+)/) || line.match(/(\d{2}):00 - (.*)/);
          if (match) {
            const hour = parseInt(match[1]);
            const note = match[2].trim();
            const sound = match[3] || defaultSoundSelect.value;
            if (!isNaN(hour) && hour >= 0 && hour <= 23 && note) {
              const date = datePicker.value;
              const key = `${date}-note-${hour}`;
              
              // Clear any existing reminders
              clearReminderTimeout(key);
              
              // Save with sound preference
              localStorage.setItem(key, JSON.stringify({
                text: note,
                sound: sound,
                timestamp: new Date().getTime()
              }));
              
              // Schedule new reminders if it's for today
              if (date === today && hour > new Date().getHours()) {
                scheduleReminder(key, hour, note, sound);
              }
              
              importedCount++;
            }
          }
        });

        if (importedCount > 0) {
          showNotification(`Successfully imported ${importedCount} reminders`, "success");
        } else {
          showNotification("No valid reminders found in the file", "error");
        }
        
        displayReminders();
        event.target.value = ""; // Reset file input
      };
      reader.readAsText(file);
    }

    // Event listeners
    datePicker.addEventListener("change", updateSlot);
    desktopNotificationsToggle.addEventListener("change", saveSettings);
    inAppNotificationsToggle.addEventListener("change", saveSettings);
    advanceAlertsToggle.addEventListener("change", saveSettings);
    defaultSoundSelect.addEventListener("change", saveSettings);

    // Initialize
    initAudioElements();
    loadSettings();
    fetchWeather();
    updateSlot();

    // Enable audio playback after user interaction
    document.addEventListener('click', function() {
      // This empty handler just enables audio playback after first interaction
    }, { once: true });
  </script>
</body>
</html>